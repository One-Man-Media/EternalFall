<!DOCTYPE html>
<html>
<head>
    <title>Eternal Fall Project Plan</title>
    <style>
        body { font-family: sans-serif; }
        #header { text-align: center; margin-bottom: 20px; }
        #add-phase-form, #add-task-form { margin: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status-dropdown { position: relative; display: inline-block; }
        .status-dropdown-content { display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; }
        .status-dropdown-content a { color: black; padding: 12px 16px; text-decoration: none; display: block; }
        .status-dropdown-content a:hover { background-color: #f1f1f1; }
        .status-dropdown:hover .status-dropdown-content { display: block; }
    </style>
</head>
<body>
    <div id="header">
        <h1>Eternal Fall Project Plan</h1>
        <button onclick="showAddPhaseForm()">Add New Phase</button>
        <button onclick="showAddTaskForm()">Add Task to Phase</button>
    </div>

    <div id="add-phase-form" style="display: none;">
        <h2>Add New Phase</h2>
        <input type="text" id="new-phase-name" placeholder="Phase Name">
        <textarea id="new-phase-description" placeholder="Phase Description"></textarea>
        <button onclick="addPhase()">Add Phase</button>
    </div>

    <div id="add-task-form" style="display: none;">
        <h2>Add Task to Phase</h2>
        <input type="text" id="new-task-name" placeholder="Task Name">
        <textarea id="new-task-description" placeholder="Task Description"></textarea>
        <input type="number" id="new-task-difficulty" placeholder="Difficulty (1-5)">
        <input type="number" id="new-task-duration" placeholder="Estimated Time (hours)">
        <select id="new-task-phase"></select>
        <button onclick="addTask()">Add Task</button>
    </div>

    <table id="project-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Description</th>
                <th>Difficulty</th>
                <th>Estimated Time</th>
                <th>Phase</th>
                <th>Progress</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div>
        <h2>Delete Item</h2>
        <select id="delete-item-select"></select>
        <button onclick="deleteItem()">Delete Selected</button>
    </div>

    <script>
        let projectData = JSON.parse(localStorage.getItem('eternalFallData')) || { phases: [], tasks: [] };

        function saveData() {
            localStorage.setItem('eternalFallData', JSON.stringify(projectData));
        }

        function renderTable() {
            const tableBody = document.querySelector('#project-table tbody');
            tableBody.innerHTML = '';
            document.getElementById('delete-item-select').innerHTML = ''; //clear delete selection.
            document.getElementById('new-task-phase').innerHTML = ""; //clear task phase selection.

            // Render phases
            projectData.phases.forEach((phase, index) => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = 'Phase';
                row.insertCell().textContent = phase.name;
                row.insertCell().textContent = phase.description;
                row.insertCell().textContent = '-';
                row.insertCell().textContent = '-';
                row.insertCell().textContent = '-';
                row.insertCell().innerHTML = createStatusDropdown(index, null, 'phase');

                const option = document.createElement("option");
                option.text = phase.name;
                option.value = index;
                document.getElementById('new-task-phase').add(option);

                const deleteOption = document.createElement("option");
                deleteOption.text = "Phase: " + phase.name;
                deleteOption.value = "phase-" + index;
                document.getElementById("delete-item-select").add(deleteOption);
            });

            // Render tasks
            projectData.tasks.forEach((task, index) => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = 'Task';
                row.insertCell().textContent = task.name;
                row.insertCell().textContent = task.description;
                row.insertCell().textContent = task.difficulty;
                row.insertCell().textContent = task.duration;
                row.insertCell().textContent = projectData.phases[task.phaseIndex].name;
                row.insertCell().innerHTML = createStatusDropdown(task.phaseIndex, index, 'task');

                const deleteOption = document.createElement("option");
                deleteOption.text = "Task: " + task.name;
                deleteOption.value = "task-" + index;
                document.getElementById("delete-item-select").add(deleteOption);
            });

            updatePhaseCompletion();
        }

        function createStatusDropdown(phaseIndex, taskIndex, type) {
            let status = type === 'phase' ? projectData.phases[phaseIndex].status || 'Not Started' : projectData.tasks[taskIndex].status || 'Not Started';
            let dropdown = `
                <div class="status-dropdown">
                    <span>${status}</span>
                    <div class="status-dropdown-content">
                        <a href="#" onclick="updateStatus('${phaseIndex}', '${taskIndex}', '${type}', 'Not Started')">Not Started</a>
                        <a href="#" onclick="updateStatus('${phaseIndex}', '${taskIndex}', '${type}', 'In Progress')">In Progress</a>
                        <a href="#" onclick="updateStatus('${phaseIndex}', '${taskIndex}', '${type}', 'Completed')">Completed</a>
                    </div>
                </div>
            `;
            return dropdown;
        }

        function updateStatus(phaseIndex, taskIndex, type, newStatus) {
            if (type === 'phase') {
                projectData.phases[phaseIndex].status = newStatus;
            } else {
                projectData.tasks[taskIndex].status = newStatus;
            }
            saveData();
            renderTable();
        }

        function updatePhaseCompletion() {
            projectData.phases.forEach((phase, phaseIndex) => {
                let completedTasks = projectData.tasks.filter(task => task.phaseIndex === phaseIndex && task.status === 'Completed').length;
                let totalTasks = projectData.tasks.filter(task => task.phaseIndex === phaseIndex).length;
                phase.completion = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            });
            saveData();
            renderTable();
        }

        function showAddPhaseForm() {
            document.getElementById('add-phase-form').style.display = 'block';
            document.getElementById('add-task-form').style.display = 'none';
        }

        function showAddTaskForm() {
            document.getElementById('add-task-form').style.display = 'block';
            document.getElementById('add-phase-form').style.display = 'none';
        }

        function addPhase() {
            projectData.phases.push({
                name: document.getElementById('new-phase-name').value,
                description: document.getElementById('new-phase-description').value,
                status: 'Not Started'
            });
            document.getElementById('new-phase-name').value = '';
            document.getElementById('new-phase-description').value = '';
            document.getElementById('add-phase-form').style.display = 'none';
            saveData();
            renderTable();
        }

        function addTask() {
            projectData.tasks.push({
                name: document.getElementById('new-task-name').value,
                description: document.getElementById('new-task-description').value,
                difficulty: document.getElementById('new-task-difficulty').value,
                duration: document.getElementById('new-task-duration').value,
                phaseIndex: parseInt(document.getElementById('new-task-phase').value),
                status: 'Not Started'
            });
            document.getElementById('new-task-
